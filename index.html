<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/style.css">
    <title>Game</title>
</head>
<body>
    <div class="wrapper" id="main_page">
 
		
		<div class="page full-page">
			<div class="invite closing-div slide-up">
				<div class="close"></div>
				Invite your friends<br /> and get rewards
				<div class="more">learn more ➞</div>
			</div>
			<div class="bottom-block">
				<div class="item-coin">0</div>
				<div class="farm-block">
					100 nuts farming per hour
					<div class="boost open-level">BOOST</div>
				</div>
				<div class="mining-btn">Start mining</div>
				<div class="claim-btn">Claim tokens<div class="count">124</div></div>
				<div class="claim-btn"><div class="countdown">Left <div id="countdown"></div></div><div class="count">4658</div></div>
			</div>
		</div>
		
		
		
		
		
		
		
 
   

		<div class="bottom-hidden-block level-block closing-div slide-down">
			<div class="close"></div>
			<div class="container">
				
				<div class="block-name">Levels</div>
				<p>Upgrade your level to collect<br /> tokens less frequently</p>
				<div class="level-list-block">
					<div class="list">
						<div class="item">10 nuts per hour · 2 hours</div>
						<div class="level">1 lvl</div>
					</div>
					<div class="list">
						<div class="item">20 nuts per hour · 2 hours </div>
						<div class="level">2 lvl</div>
					</div>
					<div class="list">
						<div class="item">30 nuts per hour · 2 hours </div>
						<div class="level">3 lvl</div>
					</div>
					<div class="list">
						<div class="item">40 nuts per hour · 2 hours </div>
						<div class="level">4 lvl</div>
					</div>
					<div class="list you">
						<div class="item">50 nuts per hour · 2 hours </div>
						<div class="you">YOU →</div>
						<div class="level">5 lvl</div>
					</div>
					<div class="list">
						<div class="item">60 nuts per hour · 2 hours </div>
						<div class="level">6 lvl</div>
					</div>
					<div class="list">
						<div class="item">70 nuts per hour · 2 hours </div>
						<div class="level">7 lvl</div>
					</div>
					<div class="list">
						<div class="item">80 nuts per hour · 2 hours </div>
						<div class="level">8 lvl</div>
					</div>
					<div class="list">
						<div class="item">90 nuts per hour · 2 hours </div>
						<div class="level">9 lvl</div>
					</div>
					<div class="list">
						<div class="item">100 nuts per hour · 2 hours </div>
						<div class="level">10 lvl</div>
					</div>
				</div>
				
			</div>
		</div>
		<div class="overflow"></div>
	</div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
	 <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script>
	let tg = window.Telegram.WebApp; //получаем объект webapp телеграма
	

let main_page = document.querySelector('#main_page');
 

$(window).trigger('resize');

if  (main_page){
    window.Telegram.WebApp.expand() //expand window after page loading
}

	$(".close").click(function() {
		$(this).parent('.closing-div').toggleClass('hide');
		$('.overflow').removeClass('show');
		$('body').removeClass('hide');
	});
	$(".overflow").click(function() {
		$('.overflow').removeClass('show');
		$('body').removeClass('hide');
		$('.bottom-hidden-block.level-block').removeClass('hide');
	});
	$(".open-level").click(function() {
		$('body').toggleClass('hide');
		$('.overflow').toggleClass('show');
		$('.bottom-hidden-block.level-block').toggleClass('hide');
	});






$(function () {
	jQuery.fn.extend({
    	countdown: function () {
            let hour = 3, min = 0, sec = 0
            render(hour, min, sec)
            
            const timer = setInterval(() => {
            	if (hour == 0 && min == 0 && sec == 0) {
                	clearInterval(timer)
                    return ;
                }
                
            	sec = dealSec(sec)
                min = dealMin(min, sec)
                hour = dealhour(hour, min, sec)
                render(hour, min, sec)
            }, 1000)
        },
    })
    
    $('#countdown').countdown()
})

function dealSec (sec) {
    const timeRange = [...Array(60).keys()].reverse()
	const idxNow = timeRange.indexOf(sec)
    const idxNext = (idxNow + 1) % timeRange.length
    return timeRange[idxNext]
}

function dealMin(min, sec) {
    const timeRange = [...Array(60).keys()].reverse()
    if (sec === 59) {
    	const idxNow = timeRange.indexOf(min)
        const idxNext = (idxNow + 1) % timeRange.length
        return timeRange[idxNext]
    }
    return min
}

function dealhour (hour, min, sec) {
	if (min === 59 && sec === 59) return hour - 1
    return hour
}

function render(hour, min, sec) {
	hour = ("00" + hour).slice(-2)
    min  = ("00" + min).slice(-2)
    sec  = ("00" + sec).slice(-2)
    
    $('#countdown').text(`${hour} : ${min} : ${sec}`)
}
</script>
</body>
</html>